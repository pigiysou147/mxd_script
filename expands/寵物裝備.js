/**
* 商城-QQ:739977676
**/

let type = 4;
let items = Array(
	//類別（展示出來的）
	Array("#r寵物裝備10餘額一個，需要購買請發車",
		//物品ID 價格
		Array(1802060,10),
Array(1802062,10),
Array(1802064,10),
Array(1802065,10),
Array(1802066,10),
Array(1802067,10),
Array(1802068,10),
Array(1802070,10),
Array(1802072,10),
Array(1802073,10),
Array(1802076,10),
Array(1802077,10),
Array(1802078,10),
Array(1802079,10),
Array(1802080,10),
Array(1802081,10),
Array(1802082,10),
Array(1802083,10),
Array(1802084,10),
Array(1802220,10),
Array(1802221,10),
Array(1802337,10),
Array(1802338,10),
Array(1802339,10),
Array(1802340,10),
Array(1802341,10),
Array(1802342,10),
Array(1802343,10),
Array(1802344,10),
Array(1802345,10),
Array(1802346,10),
Array(1802347,10),
Array(1802348,10),
Array(1802349,10),
Array(1802350,10),
Array(1802351,10),
Array(1802352,10),
Array(1802353,10),
Array(1802354,10),
Array(1802365,10),
Array(1802366,10),
Array(1802367,10),
Array(1802368,10),
Array(1802369,10),
Array(1802370,10),
Array(1802371,10),
Array(1802372,10),
Array(1802373,10),
Array(1802375,10),
Array(1802376,10),
Array(1802377,10),
Array(1802378,10),
Array(1802379,10),
Array(1802384,10),
Array(1802385,10),
Array(1802386,10),
Array(1802388,10),
Array(1802389,10),
Array(1802390,10),
Array(1802391,10),
Array(1802392,10),
Array(1802393,10),
Array(1802394,10),
Array(1802395,10),
Array(1802396,10),
Array(1802418,10),
Array(1802419,10),
Array(1802420,10),
Array(1802421,10),
Array(1802422,10),
Array(1802423,10),
Array(1802424,10),
Array(1802425,10),
Array(1802426,10),
Array(1802427,10),
Array(1802428,10),
Array(1802429,10),
Array(1802430,10),
Array(1802431,10),
Array(1802432,10),
Array(1802433,10),
Array(1802434,10),
Array(1802435,10),
Array(1802436,10),
Array(1802444,10),
Array(1802445,10),
Array(1802446,10),
Array(1802447,10),
Array(1802448,10),
Array(1802450,10),
Array(1802451,10),
Array(1802452,10),
Array(1802458,10),
Array(1802459,10),
Array(1802460,10),
Array(1802461,10),
Array(1802463,10),
Array(1802464,10),
Array(1802465,10),
Array(1802466,10),
Array(1802467,10),
Array(1802471,10),
Array(1802472,10),
Array(1802473,10),
Array(1802475,10),
Array(1802476,10),
Array(1802477,10),
Array(1802478,10),
Array(1802479,10),
Array(1802480,10),
Array(1802481,10),
Array(1802482,10),
Array(1802483,10),
Array(1802488,10),
Array(1802489,10),
Array(1802490,10),
Array(1802491,10),
Array(1802493,10),
Array(1802497,10),
Array(1802498,10),
Array(1802500,10),
Array(1802501,10),
Array(1802502,10),
Array(1802503,10),
Array(1802504,10),
Array(1802505,10),
Array(1802509,10),
Array(1802510,10),
Array(1802511,10),
Array(1802512,10),
Array(1802519,10),
Array(1802520,10),
Array(1802521,10),
Array(1802522,10),
Array(1802524,10),
Array(1802526,10),
Array(1802527,10),
Array(1802528,10),
Array(1802529,10),
Array(1802530,10),
Array(1802531,10),
Array(1802532,10),
Array(1802533,10),
Array(1802534,10),
Array(1802535,10),
Array(1802536,10),
Array(1802539,10),
Array(1802540,10),
Array(1802541,10),
Array(1802542,10),
Array(1802543,10),
Array(1802544,10),
Array(1802545,10),
Array(1802546,10),
Array(1802547,10),
Array(1802548,10),
Array(1802549,10),
Array(1802550,10),
Array(1802551,10),
Array(1802552,10),
Array(1802553,10),
Array(1802554,10),
Array(1802555,10),
Array(1802556,10),
Array(1802557,10),
Array(1802558,10),
Array(1802559,10),
Array(1802560,10),
Array(1802561,10),
Array(1802562,10),
Array(1802563,10),
Array(1802564,10),
Array(1802565,10),
Array(1802566,10),
Array(1802567,10),
Array(1802568,10),
Array(1802569,10),
Array(1802570,10),
Array(1802571,10),
Array(1802572,10),
Array(1802573,10),
Array(1802574,10),
Array(1802575,10),
Array(1802576,10),
Array(1802577,10),
Array(1802578,10),
Array(1802579,10),
Array(1802580,10),
Array(1802581,10),
Array(1802582,10),
Array(1802583,10),
Array(1802584,10),
Array(1802585,10),
Array(1802586,10),
Array(1802587,10),
Array(1802588,10),
Array(1802589,10),
Array(1802590,10),
Array(1802591,10),
Array(1802592,10),
Array(1802593,10),
Array(1802594,10),
Array(1802595,10),
Array(1802596,10),
Array(1802597,10),
Array(1802598,10),
Array(1802599,10),
Array(1802600,10),
Array(1802601,10),
Array(1802602,10),
Array(1802603,10),
Array(1802604,10),
Array(1802605,10),
Array(1802606,10),
Array(1802607,10),
Array(1802608,10),
Array(1802609,10),
Array(1802610,10),
Array(1802611,10),
Array(1802613,10),
Array(1802614,10),
Array(1802615,10),
Array(1802616,10),
Array(1802617,10),
Array(1802618,10),
Array(1802619,10),
Array(1802620,10),
Array(1802621,10),
Array(1802622,10),
Array(1802623,10),
Array(1802624,10),
Array(1802625,10),
Array(1802626,10),
Array(1802627,10),
Array(1802628,10),
Array(1802629,10),
Array(1802630,10),
Array(1802631,10),
Array(1802632,10),
Array(1802633,10),
Array(1802634,10),
Array(1802635,10),
Array(1802641,10),
Array(1802642,10),
Array(1802643,10),
Array(1802650,10),
Array(1802651,10),
Array(1802652,10),
Array(1802666,10),
Array(1802655,10),  //精靈寵裝
Array(1802656,10),
Array(1802657,10)
	)

);
let title = "";
let haveMoney = 0;
switch (type){
	case 4:
		title = "餘額"
		haveMoney = getHyPay(1);
		break;
}
while(true){
	let str = "";
	for(let i = 0; i<items.length;i++){
		if(i%4==0){
			str += "\r\n";
		}
		str += "#L"+i+"#"+items[i][0]+"#l  "
	}

	let seleted = npc.askMenu(str);
	str = "#r請選購:\r\n"
	for(let i = 1; i<items[seleted].length;i++){
		str += "#L"+i+"##v"+items[seleted][i][0]+"#  #b價格#r " +items[seleted][i][1]+" " +title+"#l\r\n";
	}
	let seletedItem = npc.askMenu(str);
	str = "#b當前選擇物品 : #v"+items[seleted][seletedItem][0]+"# 單價 :#r"+items[seleted][seletedItem][1]+title+"\r\n";
	str += "#e請輸入購買數量";
	let number;
	while(true){
		if(type != 3){
			number = npc.askNumber(str,"0",0,haveMoney/items[seleted][seletedItem][1]);
		}else{
			number = npc.askNumber(str,"0",0,9999);
		}
		if(number == 0){
			npc.say("不可以輸入 0 哦！");
		}else{
			break;
		}
	}
	str = "#b請確認購買物品：\r\n";
	str += "#b當前"+title+"："+haveMoney+"\r\n";
	str += "#b物品 : #v"+items[seleted][seletedItem][0]+"# 單價 :#r"+items[seleted][seletedItem][1]+title+"\r\n";
	str += "#b數量 : "+number+" 個#b 總價 :#r"+(items[seleted][seletedItem][1]*number)+title+"\r\n";
	let YN = npc.askYesNo(str);
	if(YN == 1){
		if(player.canGainItem(items[seleted][seletedItem][0],number)){
			switch (type){
				case 4:
					gainHyPay(-(items[seleted][seletedItem][1]*number))
					player.gainGachaponItem("["+title+"商城]",items[seleted][seletedItem][0],number,1);
					npc.say("購買成功");
					break;
			}
		}else{
			npc.say("請清理背包，您當前無法放下所購買物品");
		}
	}
}



function getHyPay(type) {
    var sql = "select * from hypay where accname = '" + getAccountName() + "'";
    var push = player.customSqlResult(sql);
    if (push.size() > 0) {
        var result = push.get(0);
        if (type == 1) {
            var pay = result.get("pay");
        } else if (type == 2) {
            var pay = result.get("payUsed");
        } else if (type == 3) {
            var pay = result.get("payReward");
        }
    } else {
        player.customSqlInsert("INSERT INTO `hypay` (`accname`, `name`) VALUES ('" + getAccountName() + "', '" + player.getName() + "')");
        return getHyPay(1);
    }

    return pay;
}
function getAccountName() {
    var i = -1;
    var sql = "select name,id from accounts where id=" + player.getAccountId() + " order by name limit 1;";
    var push = player.customSqlResult(sql);
    if (push.size() > 0) {
        var result = push.get(0);
        var name = result.get("name");
    }

    return name;
}

function gainHyPay(count) {
    var sql = "update hypay set pay =pay+? where accname = '" + getAccountName() + "';";   
    player.customSqlUpdate(sql, count);
}